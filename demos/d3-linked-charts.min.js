!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.d3=t.d3||{})}(this,function(t){"use strict";function e(){var t={};return t.add_property=function(e,a){var r="get_"+e;return t[e]=function(a){if(void 0===a)throw"No value passed in setter for property '"+e+"'.";return t[r]="function"==typeof a?a:function(){return a},t},t[r]="function"==typeof a?a:function(){return a},t},t.put_static_content=function(){},t.place=function(e){if(void 0===e&&(e="body"),"string"==typeof e&&(e=g(e),0==e.size))throw"Error in function 'place': DOM selection for string '"+node+"' did not find a node.";return t.put_static_content(e),t.update(),t},t.add_lines=function(){if(!t.real_svg)throw"Error in function 'add_lines': the chart doesn't have a svg element";t.svg||(t.svg=t.real_svg.append("g")),t.get_margin()&&t.svg.attr("transform","translate("+t.get_margin().left+", "+t.get_margin().top+")"),t.add_property("nlines").add_property("lineIds",function(){return d3.range(t.get_nlines())}).add_property("lineFun").add_property("lineStyle","").add_property("lineStepNum",100);var e=t.update;return t.update=function(){e(),t.scale_x||(t.scale_x=d3.scaleLinear().domain([0,t.get_width()]).range([0,t.get_width()]).nice()),t.scale_y||(t.scale_y=d3.scaleLinear().domain([t.get_height(),0]).range([t.get_height(),0]).nice());var a=(t.scale_x.domain()[1]-t.scale_x.domain()[0])/t.get_lineStepNum(),r=t.svg.selectAll(".line").data(t.get_lineIds());return r.exit().remove(),r.enter().append("path").attr("class","line").attr("fill","none").attr("stroke","black").attr("stroke-width",1.5).merge(r).attr("style",function(e){return t.get_lineStyle(e)}).attr("d",function(e){for(var r=[],n=t.scale_x.domain()[0];n<t.scale_x.domain()[1];n+=a)r.push({x:n,y:t.get_lineFun(e,n)});var l=d3.line().x(function(e){return t.scale_x(e.x)}).y(function(e){return t.scale_y(e.y)});return l(r)}),t},t},t}function a(){var t=e().add_property("width",500).add_property("height",400).add_property("margin",{top:20,right:10,bottom:20,left:10});return t.put_static_content=function(e){t.real_svg=e.append("svg"),t.svg=t.real_svg.append("g")},t.update=function(){return t.real_svg.attr("width",t.get_width()+t.get_margin().left+t.get_margin().right).attr("height",t.get_height()+t.get_margin().top+t.get_margin().bottom),t.svg.attr("transform","translate("+t.get_margin().left+","+t.get_margin().top+")"),t},t}function r(){var t=e();return t.put_static_content=function(e){t.real_div=e.append("div")},t}function n(){var t=a().add_property("x").add_property("y").add_property("style","").add_property("numPoints").add_property("dataIds");t.add_property("x_label","").add_property("y_label","").add_property("on_click",function(){}),t.margin({top:20,right:20,bottom:30,left:40}),t.dataIds(function(){return d3.range(t.get_numPoints())}),t.numPoints(function(){for(var e,a=0;1e4>a;a++){try{e=t.get_x(a)}catch(r){return a>0?a-1:0}if(void 0===e)return a>0?a-1:0}throw"There seem to be very many data points. Please supply a number via 'numPoints'."});var e=t.put_static_content;t.put_static_content=function(a){e(a),t.axes={},t.axes.x_g=t.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+t.get_height()+")"),t.axes.x_label=t.axes.x_g.append("text").attr("class","label").attr("fill","black").style("text-anchor","end"),t.axes.y_g=t.svg.append("g").attr("class","y axis"),t.axes.y_label=t.axes.y_g.append("text").attr("class","label").attr("fill","black").attr("transform","rotate(-90)").style("text-anchor","end")};var r=t.update;return t.update_not_yet_called=!0,t.update=function(){r();var e=d3.transition();t.update_not_yet_called?(t.update_not_yet_called=!1,e.duration(0)):e.duration(1e3),t.scale_x=d3.scaleLinear().domain(d3.extent(t.get_dataIds(),function(e){return t.get_x(e)})).range([0,t.get_width()]).nice(),t.scale_y=d3.scaleLinear().domain(d3.extent(t.get_dataIds(),function(e){return t.get_y(e)})).range([t.get_height(),0]).nice(),d3.axisBottom().scale(t.scale_x)(t.axes.x_g.transition(e)),d3.axisLeft().scale(t.scale_y)(t.axes.y_g.transition(e)),t.axes.x_label.attr("x",t.get_width()).attr("y",-6).text(t.get_x_label()),t.axes.y_label.attr("y",6).attr("dy",".71em").text(t.get_y_label());var a=t.svg.selectAll("circle.datapoint").data(t.get_dataIds());return a.exit().remove(),a.enter().append("circle").classed("datapoint",!0).attr("r",3).merge(a).on("click",t.get_on_click).transition(e).attr("cx",function(e){return t.scale_x(t.get_x(e))}).attr("cy",function(e){return t.scale_y(t.get_y(e))}).attr("style",function(e){return t.get_style(e)}),t},t}function l(){var t=r().add_property("nrows").add_property("ncols").add_property("value");t.add_property("mode","default").add_property("height",800).add_property("width",1e3).add_property("margin",{top:100,bottom:50,left:100,right:20}).add_property("colLabels",function(t){return t}).add_property("rowLabels",function(t){return t}).add_property("colIds",function(){return d3.range(t.get_ncols())}).add_property("rowIds",function(){return d3.range(t.get_nrows())}).add_property("colour",function(e){return t.colourScale(e)}).add_property("heatmapRow",function(e){return t.get_rowIds().indexOf(e)}).add_property("heatmapCol",function(e){return t.get_rowIds().indexOf(e)}).add_property("palette",d3.interpolateOrRd).add_property("colourRange",function(){return t.dataRange()}).add_property("legendSteps",21).add_property("labelMouseOver").add_property("labelMouseOut").add_property("cellMouseOver").add_property("cellMouseOut").add_property("labelClick").add_property("cellClick",function(){}),t.dataRange=function(){var e,a,r=0;do a=d3.extent(t.get_colIds(),function(e){return t.get_value(t.get_rowIds()[r],e)}),"undefined"==typeof e&&(e=a),a[0]<e[0]&&(e[0]=a[0]),a[1]>e[1]&&(e[1]=a[1]),r++;while(r<t.get_nrows());return e},t.reorderRow=function(e){if("flip"==e)return t.get_heatmapRow("__flip__"),t;var a,r=t.get_rowIds().slice();return r=r.sort(e),t.heatmapRow(function(n){if("__flip__"==n)return void(r=r.reverse());var l=t.get_rowIds(),o=r.filter(function(t){return-1!=l.indexOf(t)});if(o.length!=l.length&&(o=l.sort(e),r=o.slice()),a=o.indexOf(n),a>-1)return a;throw"Wrong rowId in obj.get_heatmapRow"}),t},t.reorderCol=function(e){if("flip"==e)return t.get_heatmapCol("__flip__"),t;var a,r=t.get_colIds().slice();return r=r.sort(e),t.heatmapCol(function(n){if("__flip__"==n)return void(r=r.reverse());var l=t.get_colIds(),o=r.filter(function(t){return-1!=l.indexOf(t)});if(o.length!=l.length&&(o=l.sort(e),r=o.slice()),a=o.indexOf(n),a>-1)return a;throw"Wrong rowId in obj.get_heatmapRow"}),t},t.resetColourScale=function(){var e=d3.scaleSequential(t.get_palette);t.colourScale=function(a){return a=(a-t.get_colourRange()[0])/(t.get_colourRange()[1]-t.get_colourRange()[0]),e(a)}};var e=t.put_static_content;return t.put_static_content=function(a){e(a),t.container=a,t.real_div.style("position","relative"),a.append("div").attr("class","inform hidden").append("p").attr("class","value"),t.real_svg=t.real_div.append("svg"),t.real_svg.append("g").attr("class","row label_panel"),t.real_svg.append("g").attr("class","col label_panel"),t.real_svg.append("g").attr("class","legend_panel"),t.resetColourScale()},t.labelMouseOver(function(){d3.select(this).classed("hover",!0)}),t.labelMouseOut(function(){d3.select(this).classed("hover",!1)}),t.cellMouseOver(function(e){d3.select(this).attr("fill",function(e){return d3.rgb(t.get_colour(t.get_value(e[0],e[1]))).darker(.5)}).classed("hover",!0),t.real_svg.select(".col").selectAll(".label").filter(function(t){return t==e[1]}).classed("hover",!0),t.real_svg.select(".row").selectAll(".label").filter(function(t){return t==e[0]}).classed("hover",!0),t.container.select(".inform").style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-10+"px").select(".value").html("Row: <b>"+e[0]+"</b>;<br>Col: <b>"+e[1]+"</b>;<br>value = "+t.get_value(e[0],e[1])),t.container.select(".inform").classed("hidden",!1)}),t.cellMouseOut(function(){d3.select(this).attr("fill",function(e){return t.get_colour(t.get_value(e[0],e[1]))}).classed("hover",!1),t.real_svg.selectAll(".label").classed("hover",!1),t.container.select(".inform").classed("hidden",!0)}),t.labelClick(function(e){var a;a=d3.select(this.parentNode).classed("row")?"row":"col",d3.select(this).classed("selected")?("col"==a?t.reorderRow("flip"):t.reorderCol("flip"),t.update()):(t.real_svg.select("."+a).selectAll(".label").classed("selected",!1),d3.select(this).classed("selected",!0),"col"==a?t.reorderRow(function(a,r){return t.get_value(r,e)-t.get_value(a,e)}):t.reorderCol(function(a,r){return t.get_value(e,r)-t.get_value(e,a)}),t.update())}),t.update_not_yet_called=!0,t.updateSVG=function(e,a){t.real_svg.selectAll("canvas").remove(),t.svg=t.real_svg.selectAll(".heatmap_body").data(["x"]),t.svg.enter().append("g").attr("class","heatmap_body").merge(t.svg).transition(a).attr("transform","translate("+t.get_margin().left+", "+t.get_margin().top+")"),t.svg=t.real_svg.select(".heatmap_body");var r=t.svg.selectAll(".data_row").data(t.get_rowIds().slice());r.exit().remove(),r.enter().append("g").attr("class","data_row").merge(r).transition(a).attr("transform",function(a){return"translate(0, "+t.get_heatmapRow(a)*e.height+")"});var n=t.svg.selectAll(".data_row").selectAll(".data_point").data(function(e){return t.get_colIds().map(function(t){return[e,t]})});n.exit().remove(),n.enter().append("rect").attr("class","data_point").on("mouseover",t.get_cellMouseOver).on("mouseout",t.get_cellMouseOut).on("click",t.get_cellClick).merge(n).transition(a).attr("x",function(a){return t.get_heatmapCol(a[1])*e.width}).attr("fill",function(e){return t.get_colour(t.get_value(e[0],e[1]))}).attr("width",e.width).attr("height",e.height)},t.updateCanvas=function(){t.real_svg.selectAll(".heatmapBody").remove(),t.real_svg.selectAll("canvas").remove();var e=t.real_div.append("canvas").style("position","absolute").style("left",t.get_margin().left+"px").style("top",t.get_margin().top+"px").property("width",t.get_width()).property("height",t.get_height()).node().getContext("2d"),a=document.createElement("canvas");a.width=t.get_ncols(),a.height=t.get_nrows();for(var r,n,l=new ImageData(t.get_ncols(),t.get_nrows()),o=0;o<t.get_rowIds().length;o++)for(var i=0;i<t.get_colIds().length;i++)r=d3.rgb(t.get_colour(t.get_value(t.get_rowIds()[o],t.get_colIds()[i]))),n=t.get_heatmapRow(t.get_rowIds()[o])*t.get_ncols()*4+4*t.get_heatmapCol(t.get_colIds()[i]),l.data[n]=r.r,l.data[n+1]=r.g,l.data[n+2]=r.b;for(var o=0;o<t.get_ncols()*t.get_nrows();o++)l.data[4*o+3]=255;a.getContext("2d").putImageData(l,0,0),e.imageSmoothingEnabled=!1,e.drawImage(a,0,0,t.get_colIds().length,t.get_rowIds().length,0,0,t.get_width(),t.get_height())},t.updateSVGTest=function(e,a){t.real_svg.selectAll("canvas").remove();var r=t.real_svg.selectAll(".heatmap_body").data(["x"]);r.enter().append("g").attr("class","heatmap_body").merge(r).transition(a).attr("transform","translate("+t.get_margin().left+", "+t.get_margin().top+")"),r=t.real_svg.select(".heatmap_body");var n,l;r.selectAll(".datapoint").classed("transient",!0);for(var o=0;o<t.get_rowIds().length;o++)for(var i=0;i<t.get_colIds().length;i++)n="c"+t.get_rowIds()[o]+"_"+t.get_colIds()[i],l=r.select("#"+n).transition(a),l.empty()&&(l=r.append("rect").attr("id",n).attr("class","cell datapoint").attr("width",e.width).attr("height",e.height)),l.transition(a).attr("x",t.get_heatmapCol(t.get_colIds()[i])*e.width).attr("y",t.get_heatmapRow(t.get_rowIds()[o])*e.height).attr("fill",t.get_colour(t.get_value(t.get_rowIds()[o],t.get_colIds()[i]))),l.classed("transient",!1);r.selectAll(".datapoint").filter(function(){return d3.select(this).classed("transient")}).remove()},t.update=function(){var e;t.update_not_yet_called?(e=d3.transition().duration(0),t.update_not_yet_called=!1):e=d3.transition().duration(1e3),t.real_div.transition(e).style("width",t.get_width()+t.get_margin().left+t.get_margin().right+"px").style("height",t.get_height()+t.get_margin().top+t.get_margin().bottom+"px"),t.real_svg.transition(e).attr("height",t.get_height()+t.get_margin().top+t.get_margin().bottom).attr("width",t.get_width()+t.get_margin().left+t.get_margin().right),t.real_svg.selectAll(".label_panel").transition(e).attr("transform","translate("+t.get_margin().left+", "+t.get_margin().top+")"),t.real_svg.select(".legend_panel").transition(e).attr("transform","translate("+t.get_margin().left+", "+(t.get_height()+t.get_margin().top)+")");var a={width:t.get_width()/t.get_ncols(),height:t.get_height()/t.get_nrows()},r=t.real_svg.select(".col").selectAll(".label").data(t.get_colIds().slice());r.exit().remove(),r.enter().append("text").attr("class","label").attr("transform","rotate(-90)").style("text-anchor","start").on("mouseover",t.get_labelMouseOver).on("mouseout",t.get_labelMouseOut).on("click",t.get_labelClick).merge(r).transition(e).attr("font-size",d3.min([a.width,12])).attr("dy",function(e){return a.width*(t.get_heatmapCol(e)+1)}).attr("dx",2).text(function(e){return t.get_colLabels(e)});var n=t.real_svg.select(".row").selectAll(".label").data(t.get_rowIds().slice());n.exit().remove(),n.enter().append("text").attr("class","label").style("text-anchor","end").on("mouseover",t.get_labelMouseOver).on("mouseout",t.get_labelMouseOut).on("click",t.get_labelClick).merge(n).transition(e).attr("font-size",d3.min([a.height,12])).attr("dy",function(e){return a.height*(t.get_heatmapRow(e)+1)}).attr("dx",-2).text(function(e){return t.get_rowLabels(e)});var l=(t.get_colourRange()[1]-t.get_colourRange()[0])/(t.get_legendSteps()-1),o=[],i=20,s=10;i*t.get_palette().length>t.get_width()&&(i=t.get_width()/t.get_palette().length);for(var d=0;d<t.get_legendSteps();d++)o.push((t.get_colourRange()[0]+d*l).toPrecision(2));var g=t.real_svg.select(".legend_panel").selectAll(".legend").data(o);if(g.enter().append("g").attr("class","legend").attr("num",function(t,e){return e}),g=t.real_svg.select(".legend_panel").selectAll(".legend"),g.append("rect"),g.append("text"),g.attr("transform",function(t,e){return"translate("+i*e+", 0)"}),g.selectAll("rect").attr("y",1.2*s).attr("width",i).attr("height",s).attr("fill",function(){return t.colourScale(d3.select(this.parentNode).datum())}),g.selectAll("text").text(function(){return d3.select(this.parentNode).attr("num")%2==0?d3.select(this.parentNode).datum():void 0}).attr("dy",4*s).attr("font-size",d3.min([1.5*s-1,1.5*i])),"default"==t.get_mode()&&t.mode(t.get_ncols*t.get_nrows>5e3?"canvas":"svg"),"canvas"==t.get_mode())return t.updateCanvas(a),t;if("svg"==t.get_mode())return t.updateSVG(a,e),t;if("svg_test"==t.get_mode())return t.updateSVGTest(a,e),t;throw"Error in function 'heatmapChart.update': mode did not correspond to any existing type ('canvas', 'svg' or 'default')"},t}function o(t){var e={};return function(){return"clear"===arguments[0]?void(e={}):(arguments in Object.keys(e)||0==arguments.length&&0!=Object.keys(e).length||(e[arguments]=t.apply(void 0,arguments)),e[arguments])}}function i(t,e,a){return 1/(1+Math.exp(-a*(t-e)))}function s(t,e,a,r){var n=i(a,t,e,0,1),l=i(r,t,e,0,1),o=Math.min(n,l);return function(a){return(i(a,t,e,1)-o)/Math.abs(l-n)}}function d(){var t=a().add_property("straightColorScale").add_property("midpoint",void 0).add_property("slopewidth",void 0).height(50);t.straightColorScale(d3.scaleLinear().range(["white","darkblue"])),t.clamp_markers=function(){var e=d3.min(t.get_straightColorScale.domain()),a=d3.max(t.get_straightColorScale.domain());t.get_midpoint()<e&&t.midpoint(e),t.get_midpoint()>a&&t.midpoint(a),t.get_slopewidth()>a-e&&t.slopewidth(a-e),t.get_slopewidth()<e-a&&t.slopewidth(e-a)};var e=t.put_static_content;t.put_static_content=function(a){e(a),t.axis=t.svg.append("g").attr("class","axis");var r=t.real_svg.append("defs");t.gradient=r.append("linearGradient").attr("id","scaleGradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),t.gradient.selectAll("stop").data(d3.range(100)).enter().append("stop").attr("offset",function(t){return t+"%"}),t.colorBar=t.svg.append("rect").attr("x","0").attr("y","5").attr("height",20).attr("fill","url(#scaleGradient)").style("stroke","black").style("stroke-width","1"),r.append("path").attr("id","mainMarker").attr("d","M 0 0 L 8 5 L 8 25 L -8 25 L -8 5 Z").style("fill","gray").style("stroke","black"),r.append("path").attr("id","rightMarker").attr("d","M 0 0 L 5 5 L 5 15 L 0 15 Z").style("fill","lightgray").style("stroke","black"),r.append("path").attr("id","leftMarker").attr("d","M 0 0 L -5 5 L -5 15 L 0 15 Z").style("fill","lightgray").style("stroke","black"),t.mainMarker=t.svg.append("use").attr("xlink:href","#mainMarker").attr("y",28).call(d3.drag().on("drag",function(){t.midpoint(t.get_midpoint()+t.pos_scale.invert(d3.event.dx)),t.clamp_markers(),t.update()})),t.rightMarker=t.svg.append("use").attr("xlink:href","#rightMarker").attr("y",30).call(d3.drag().on("drag",function(){t.slopewidth(t.get_slopewidth()+t.pos_scale.invert(d3.event.dx)),t.clamp_markers(),t.update()})),t.leftMarker=t.svg.append("use").attr("xlink:href","#leftMarker").attr("y",30).call(d3.drag().on("drag",function(){t.slopewidth(t.get_slopewidth()-t.pos_scale.invert(d3.event.dx)),t.clamp_markers(),t.update()}))};var r=t.update;return t.update=function(){r();var e=d3.scaleLinear().domain([0,100]).range(t.get_straightColorScale.domain());void 0==t.get_midpoint()&&t.midpoint(e(50)),void 0==t.get_slopewidth()&&t.slopewidth(e(15)),t.pos_scale=d3.scaleLinear().range([0,t.get_width()]).domain(t.get_straightColorScale.domain()),d3.axisTop().scale(t.pos_scale)(t.axis),t.colorBar.attr("width",t.get_width()),t.the_sigmoid=s(t.get_midpoint(),1.38/t.get_slopewidth(),t.get_straightColorScale.domain()[0],t.get_straightColorScale.domain()[1]),t.gradient.selectAll("stop").data(d3.range(100)).style("stop-color",function(a){return t.get_straightColorScale(e(100*t.the_sigmoid(e(a))))}),t.mainMarker.attr("x",t.pos_scale(t.get_midpoint())),t.rightMarker.attr("x",t.pos_scale(t.get_midpoint()+t.get_slopewidth())),t.leftMarker.attr("x",t.pos_scale(t.get_midpoint()-t.get_slopewidth()))},t}var g=d3.select;t.chartBase=e,t.svgChartBase=a,t.divChartBase=r,t.scatterChart=n,t.heatmapChart=l,t.cache=o,t.sigmoidColorSlider=d,Object.defineProperty(t,"__esModule",{value:!0})});